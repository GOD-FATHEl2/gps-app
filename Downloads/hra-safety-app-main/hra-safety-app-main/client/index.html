<!doctype html>
<html lang="sv">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <meta name="mobile-web-app-capable" content="yes"/>
  <meta name="apple-mobile-web-app-capable" content="yes"/>
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
  <title>Högriskarbete – Riskbedömning</title>
  <link rel="stylesheet" href="style.css"/>
</head>
<body>
<header>
  <div class="header-content">
    <h1>Bedömning av högriskarbete</h1>
    <button id="mobileMenuToggle" class="mobile-menu-toggle" aria-label="Toggle menu">
      <span class="hamburger"></span>
      <span class="hamburger"></span>
      <span class="hamburger"></span>
    </button>
  </div>
  <nav id="nav" class="hidden">
    <button data-view="form">Ny bedömning</button>
    <button data-view="mine">Mina</button>
    <button data-view="dash" class="role-sup hidden">Dashboard</button>
    <button data-view="users" class="role-admin hidden">Användare</button>
    <button onclick="window.open('information.html', '_blank')">ℹ️ Info</button>
    <button id="logout" class="right">Logga ut</button>
  </nav>
</header>

<main>
  <!-- LOGIN -->
  <section id="loginView" class="card">
    <h2>Logga in</h2>
    
    <!-- MSAL Authentication Option -->
    <div class="auth-options">
      <button id="msalLoginBtn" class="msal-login-btn">
        <span class="microsoft-icon">🏢</span>
        Logga in med Microsoft
      </button>
      <div id="networkStatus" class="network-status hidden">
        <small>🌐 Nätverksstatus: <span id="networkStatusText">Testar...</span></small>
      </div>

      <!-- Password login toggle button (replaces Development Bypass) -->
      <button id="togglePwdLoginBtn" class="dev-bypass-btn" aria-expanded="false">
        <span>🔑</span>
        Logga in med lösenord
      </button>
    </div>

    <!-- Divider (hidden until password login opens) -->
    <div id="dividerOr" class="divider" style="display:none;">
      <span>eller</span>
    </div>
    
    <!-- Traditional Login (hidden by default until the toggle is clicked) -->
    <div class="traditional-login" id="passwordLogin" style="display:none;">
      <div class="grid2">
        <label>Användarnamn<input id="lu" autocomplete="username"></label>
        <label>Lösenord<input id="lp" type="password" autocomplete="current-password"></label>
      </div>
      <button id="loginBtn">Logga in med lösenord</button>
    </div>
    
    <p id="loginMsg" class="warn hidden"></p>
    <div id="testUserHints" class="test-user-hints hidden">
      <p class="hint">📝 Testa med dessa användare:</p>
      <div class="test-users">
        <div class="test-user">👤 <strong>test1</strong> / test123 <em>(admin)</em></div>
        <div class="test-user">👤 <strong>test2</strong> / test123 <em>(supervisor)</em></div>
        <div class="test-user">👤 <strong>test3</strong> / test123 <em>(underhåll)</em></div>
      </div>
    </div>
    <p class="hint"> -------------------------------------------------------------------     </p>
  </section>

  <!-- FORM -->
  <section id="formView" class="card hidden"></section>

  <!-- MY LIST -->
  <section id="mineView" class="card hidden">
    <h2>Bedömningar</h2>
    <div id="mineTable"></div>
  </section>

  <!-- DASHBOARD (supervisor/superintendent/admin) -->
  <section id="dashView" class="card hidden">
    <h2>Dashboard (senaste 30 dagar)</h2>
    <div id="stats"></div>
    <button id="refreshDash">Uppdatera</button>
    <div id="allTable" style="margin-top:12px"></div>
  </section>

  <!-- USERS (admin) -->
  <section id="usersView" class="card hidden">
    <h2>Användarhantering</h2>
    <div class="grid3">
      <label>Namn<input id="u_name"></label>
      <label>Användarnamn<input id="u_user"></label>
      <label>Lösenord<input id="u_pass" type="password"></label>
      <label>Roll
        <select id="u_role">
          <option value="underhall">Underhåll</option>
          <option value="supervisor">Supervisor</option>
          <option value="superintendent">Superintendent</option>
          <option value="admin">Administrator</option>
        </select>
      </label>
      <label>Aktiv
        <select id="u_active"><option value="1">Ja</option><option value="0">Nej</option></select>
      </label>
    </div>
    <button id="addUser">Lägg till användare</button>
    <div id="usersTable" style="margin-top:12px"></div>
  </section>
</main>

<footer>
  <small> Copyright AB Volvo 2025 VCT- Volvo-TBA • </small>
</footer>

<script src="msal-diagnostics.js"></script>
<script src="msalAuthService.js"></script>
<script src="app.js"></script>
<script src="dynamic-ui.js"></script>
<script src="image-upload.js"></script>
<script src="notifications.js"></script>

<!-- Toggle logic for password login -->
<script>
document.addEventListener('DOMContentLoaded', () => {
  const toggleBtn = document.getElementById('togglePwdLoginBtn');
  const pwdSection = document.getElementById('passwordLogin');
  const divider = document.getElementById('dividerOr');

  const openPwd = () => {
    pwdSection.style.display = '';
    divider.style.display = '';
    toggleBtn.setAttribute('aria-expanded', 'true');
    const user = document.getElementById('lu');
    if (user) user.focus();
  };

  const closePwd = () => {
    pwdSection.style.display = 'none';
    divider.style.display = 'none';
    toggleBtn.setAttribute('aria-expanded', 'false');
  };

  // Ensure hidden at load
  closePwd();

  toggleBtn.addEventListener('click', () => {
    const visible = pwdSection.style.display !== 'none';
    visible ? closePwd() : openPwd();
  });
});
</script>
</body>
</html>
